<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap">
<link rel="stylesheet" href="main.css">
<style>
:root {
    --primary: #1a9de6;
    --foreground: #ffffff;
    --background: #0d0e11;
    --popup-background: rgba(0, 0, 0, 0.8);
}

.level-container {
    width: 250px;
    margin: 10px;
    background-color: #1f2124;
    color: var(--foreground);
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    padding: 15px;
    text-align: center;
}

.popup-container {
    display: none;
    position: fixed;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: var(--popup-background);
    z-index: 1000;
    overflow-y: auto;
    padding: 20px;
    box-sizing: border-box;
    text-align: center;
}

.popup-content {
    width: 90%;
    margin: 0 auto;
    background-color: var(--background);
    color: var(--foreground);
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    padding: 20px;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
}

.close-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    color: var(--foreground);
    font-size: 20px;
    cursor: pointer;
}

.display-box, .text-box {
    width: 100%;
    border-radius: 12px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    box-sizing: border-box;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: flex-start;
    padding: 20px;
}

.text-box {
    background-color: var(--background);
    color: var(--foreground);
    padding-top: calc(50% - 10px);
}

.input-field {
    width: 100%;
    padding: 10px;
    font-size: 16px;
    border: none;
    background-color: var(--background);
    color: var(--foreground);
    box-sizing: border-box;
    outline: none;
    resize: none;
    overflow-y: auto;
    border-radius: 8px;
    margin-bottom: 10px;
    border: 1px solid rgba(255, 255, 255, 0.15);
}

.input-box {
    width: 100%;
    text-align: left;
}

.button-container {
    display: flex;
    justify-content: center;
}

.submit-btn, .cancel-btn {
    background-color: var(--primary);
    color: var(--foreground);
    border: none;
    padding: 8px 16px;
    border-radius: 5px;
    font-size: 14px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    margin-right: 10px;
}

.submit-btn:hover, .cancel-btn:hover {
    background-color: #147bb1;
}

.markdown-content img {
    max-width: 100%;
    height: auto;
    display: block;
    margin-bottom: 10px;
}

.text-content {
    width: 100%;
}
</style>
<title>Styled Level Containers</title>
</head>
<body>

<div style="display: flex;">
    {levels}

    <div class="text-9xl level-container" onclick="openPopup(-1)" style="cursor: pointer;">
        <h1>
            +
        </h1>
    </div>
</div>

<div class="popup-container" id="popupContainer">
    <div class="popup-content" id="popupContent">
        <h1 id="level_id">Level 0</h1>
        <div class="wrapper" style="width: 100%;">
            <div class="display-box" style="height: 50vh; width: 40%; border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 10px; margin-right: 5vw;">
                <div class="text-content" id="displayBox">
                    
                </div>
            </div>
            <div style="height: 50vh; width: 40%; border-radius: 10px;">
                <textarea class="input-field" id="inputField" placeholder="Enter Markdown or URL" style="height: 50vh;"></textarea>
            </div>
        </div>
        <div class="input-box">
            <input type="text" id="sourceHintField" class="input-field" placeholder="Source Hint" style="width: 20%;">
        </div>
        <div class="input-box">
            <input type="text" id="answerField" class="input-field" placeholder="Answer" style="width: 20%;">
        </div>
        <div class="input-box">
            <input type="text" id="levelId" class="input-field" placeholder="Level Id" style="width: 20%;">
        </div>
        <div class="button-container">
            <button class="submit-btn" onclick="submitForm()">Submit</button>
            <button class="cancel-btn" onclick="deleteLevel()">Delete</button>
            <button class="cancel-btn" onclick="closePopup()">Cancel</button>
        </div>
    </div>
    <button class="close-btn" onclick="closePopup()">Close</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js" integrity="sha512-LhccdVNGe2QMEfI3x4DVV3ckMRe36TfydKss6mJpdHjNFiV07dFpS2xzeZedptKZrwxfICJpez09iNioiSZ3hA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
    var levelsData={levelsData}
    const converter = new showdown.Converter();
    const inputEl = document.getElementById('inputField');
    const displayEl = document.getElementById('displayBox');
    const popupContainer = document.getElementById('popupContainer');
    const popupContent = document.getElementById('popupContent');
    const sourceHintField = document.getElementById('sourceHintField');
    const answerField = document.getElementById('answerField');
    const levelName = document.getElementById("level_id")

    function updateDisplay() {
        const inputValue = inputEl.value.trim();
        const html = converter.makeHtml(inputValue);
        displayEl.innerHTML = `${html}`;
    }
    
    inputEl.addEventListener('input', updateDisplay);

    function openPopup(levelNumber) {
        if (levelNumber==-1) {
            inputEl.value=""
            displayEl.value=""
            sourceHintField.value = ''
            answerField.value = ''
            popupContainer.style.display = 'flex'
            levelName.innerText="New Level"
            document.getElementById("levelId").value=""
            updateDisplay()
        } else {
            sourceHintField.value = levelsData[levelNumber]["sourcehint"]
            answerField.value = levelsData[levelNumber]["answer"]
            inputEl.value = levelsData[levelNumber]["markup"]
            popupContainer.style.display = 'flex'
            levelName.innerText="Level "+String(levelNumber)
            document.getElementById("levelId").value=String(levelNumber)
            updateDisplay()
        }
    }

    function closePopup(){
        popupContainer.style.display = 'none';
    }

    function submitForm() {
        const sourceHint = sourceHintField.value.trim();
        const answer = answerField.value.trim();
        var levelId=document.getElementById("levelId").value
        fetch("/set_level?source="+encodeURIComponent(sourceHint)+"&answer="+encodeURIComponent(answer)+"&markup="+encodeURIComponent(inputEl.value.trim())+"&level="+String(Number(levelId))).then((x)=>{
            window.location="/admin"
        })
    }
    function deleteLevel() {
        var levelId=document.getElementById("levelId").value
        fetch("/delete_level?level="+encodeURIComponent(levelId)).then(()=>{
            window.location="/admin"
        })
    }
</script>

</body>
</html>
